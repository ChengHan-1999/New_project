Texture2D tex : register(t0);
Texture2D normalTex  : register(t1);
SamplerState samplerLinear : register(s0);
cbuffer LightCB : register(b2)
{
    float3 lightDir;
    float pad0;

    float3 lightColor;
    float pad1;
};
struct PS_INPUT
{
 float4 Pos : SV_POSITION;
 float3 Normal : NORMAL;
 float3 Tangent : TANGENT;
 float2 TexCoords : TEXCOORD;
};
float4 PS(PS_INPUT input) : SV_Target0
{
 	float4 colour = tex.Sample(samplerLinear, input.TexCoords);
	if (colour.a < 0.5f)
        discard;
	float3 N = normalize(input.Normal);
    	float3 T = normalize(input.Tangent);
  	float3 B = normalize(cross(N, T));
	float3x3 TBN = float3x3(T, B, N);
	float3 normalTS = normalTex.Sample(samplerLinear, input.TexCoords).xyz;
	normalTS = normalTS * 2.0f - 1.0f;

    	float3 worldNormal = normalize(mul(normalTS, TBN));

	//float3 objN = normalize(input.Normal);
        float3 objLight = normalize(-lightDir);
	float3 NDotLight = max(dot(worldNormal,objLight),0.0f);
	float3 ambient = colour.rgb * 0.4f;
	float3 Lighteff = colour.rgb * lightColor * NDotLight + ambient;
 	return float4(Lighteff,1.0f);
}
